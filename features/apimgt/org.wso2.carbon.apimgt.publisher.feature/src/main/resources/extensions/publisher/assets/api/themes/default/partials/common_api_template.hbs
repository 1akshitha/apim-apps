<script language="javascript">
	//TODO move to code segment
	var VERBS = ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'];
	var AUTH_TYPES = [
		{"value": "None", "text": "{{t "None"}}"},
		{"value": "Application", "text": "{{t "Application"}}"},
		{"value": "Application User", "text": "{{t "Application User"}}"},
		{"value": "Application & Application User", "text": "{{t "Application & Application User"}}"}
	];

	var TIERS = [
		{{#each api.configuredTiers}}
			{"value": "{{this.tierName}}", "text": "{{this.tierDisplayName}}"}
			{{#unless this.last}},{{/unless}}
		{{/each}}
	];

		{{#each api.configuredTiers}}
			{{#if this.last}}
			var DEFAULT_TIER = "{{this.tierName}}";
			{{/if}}
		{{/each}}
	var DEFAULT_AUTH = "Application & Application User";
	var OPTION_DEFAULT_AUTH = "None";
	var insequence = "{{api.inSequence}}";
	var outsequence = "{{api.outSequence}}";
	var faultsequence = "{{api.faultSequence}}";
	var inSequencesLoaded = false;
	var outSequencesLoaded = false;
	var faultSequencesLoaded = false;
</script>
<center>
<ul class="new-sub-menu-wizard" style="margin:0 auto">
    <li>
        <a href='{{url ""}}/asts/api/create' class="wizard-active">
            <div class="wizard-number">1</div>
            <span>Design</span>
        </a>
    </li>
    <li>
        <a href='{{url ""}}/asts/api/implement' class="<%= implement_wlabel%>">
            <div class="wizard-number">2</div>
            <span>Implement</span>
        </a>
    </li>
    <li>
        <a href='{{url ""}}/asts/api/manage' class="<%= manage_wlabel%>">
            <div class="wizard-number" >3</div>
            <span>Manage</span>
        </a>
    </li>
</ul>
</center> 
<h1>Design API</h1>
<div>
    <a href='' class='btn'><i class='icon-download-alt'></i>Import Swagger Definition</a>
</div>

<form id="form-asset-create" class='form-horizontal' method='post' action='{{url ""}}/apis/assets?type={{rxt.shortName}}' enctype="multipart/form-data">
    <legend>General Details</legend>
    {{#unless api}}
     <div class='control-group'>
        <label class='control-label' for='overview_name'>Name:<span class="requiredAstrix">*</span></label>
        <div class='controls'>
            <input type='text' id='overview_name' class="input-xlarge required" name='overview_name' >
             <a class="icon-question-sign help_popup" help_data="name_help"></a>
            <p id="name_help" class="hide">{{ t "Display name to be shown in the API Store."}}</p>
        </div>
    </div>
    <div class='control-group'>
        <label class='control-label'>Context:<span class="requiredAstrix">*</span></label>
        <div class='controls'>
            <input type='text' id='overview_context' name='overview_context' class="input-xlarge required" >
             <a class="icon-question-sign help_popup" help_data="context_help"></a>
            <p id="context_help" class="hide">{{t "contextHelpMsg"}}</p>
        </div>
    </div>
    <div class='control-group'>
        <label class='control-label'>Version:<span class="requiredAstrix">*</span></label>
        <div class='controls'>
            <input type='text' id='overview_version' name='overview_version' class="input required validInput noSpace" >
            <p class="help-block">{{t "E.g.,: v1.0.0 ,v1.0 , 1.0.0, 1.0"}}</p>
        </div>
    </div>
    {{else}}
    <input type="hidden" name="overview_name" value="{{name}}" />
    <input type="hidden" name="overview_version" value="{{version}}" />
    <input type="hidden" name="overview_provider" value="{{provider}}" />
    <input type="hidden" name="overview_context" value="{{context}}" />

    {{/unless}}
    <div class='control-group'>
        <label class='control-label'>Visibility:</label>

        <div class="controls">
                <select class="select required" id="visibility" name="visibility">
                {{#if api}}
                    <option value="public"  {{#if public_visibility}} selected="selected" {{/if}}>Public</option>
                    <option value="private" {{#if private_visibility}} selected="selected" {{/if}}>Restricted by Roles</option>                    
                    
                {{else}}
                    <option value="public">Public</option>
                    <option value="private">Restricted by Roles</option>               
                {{/if}}                            
                </select>

                </div>
    </div>
   {{#if api }}
        <div class="control-group" id="rolesDiv" {{#unless private_visibility}}style="display: none;"{{/unless}}>
                <label class="control-label" for="roles" id="rolesLabel" name="rolesLabel">
                    {{t "roles"}}:<span class="requiredAstrix">*</span>
                </label>
                <div class="controls">
                    <input type="text" class="input required validInput validateRoles"
                    id="roles" name="roles"  value="{{roles}}"/>
                    <p class="help-block" id="rolesHelp">{{t "Comma separated list (e.g.,: role1,role2,role3)"}}</p>
                </div>
            </div>
    {{else}}
        <div class="control-group" id="rolesDiv" style="display: none;">
            <label class="control-label" for="roles" id="rolesLabel" name="rolesLabel">
                {{t "roles"}}:<span class="requiredAstrix">*</span>
            </label>
            <div class="controls">
                <input type="text" class="input required validInput validateRoles"
                id="roles" name="roles"/>
                <p class="help-block" id="rolesHelp">{{t "Comma separated list (e.g.,: role1,role2,role3)"}}</p>
            </div>
        </div>
     {{/if}}

    {{#if api}}
            <div class="control-group">
                <label class="control-label" for="imageUrl">{{t "Thumbnail"}}</label>
                <div class="controls">
                    <div class="pull-left">
                         {{#unless thumb}} <div><img id="apiEditThumb" alt="" src="{{url "/themes/default/img/icons/ico-sort.png"}}"/></div>
                         {{else}}
                        <div><img id="apiEditThumb" alt="" src="<%=jagg.getRegistryPath(api.thumb)%>"/></div> {{/unless}}
                        <a onclick="javascript:$('#imageUrl').toggle('slow')" style="cursor: pointer">
                            <i class="icon-picture"></i> {{t "Change Icon"}}
                        </a>
                    </div>
                    <div class="pull-left" id="imageUrl" style="display:none;">
                        <div id="apiThumb-container" class="pull-left"> <input type="file" class="input-xlarge validateImageFile" name="apiThumb" /></div>
                        <input class="pull-left btn" type="button" id="clearThumb" value="{{t "clear"}}"/>
                        <div class="help-block pull-left inline-help">
                            <ul>
                                <li>{{t "Size (max): 1MB"}}</li>
                                <li>{{t "Dimensions (max): 100 x 100 pixels"}}</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
    {{else}}
     <div class="control-group">
     <label class="control-label" for="apiThumb">{{t "Thumbnail"}}:</label>
     <div class="controls">
     <div id="inpFile" class="pull-left">
     <div id="apiThumb-container"  style="display: inline;">
     <input type="file" class="input-xlarge" id="overview_thumbnail" name="overview_thumbnail"/></div>
     </div>
     <input type="button" class="btn pull-left" id="clearThumb" value="{{t "clear"}}"/>
     <div class="help-block pull-left inline-help">
     <ul>
     <li>{{t "Size (max): 1MB"}}</li>
     <li>{{t "Dimensions (max): 100 x 100 pixels"}}</li>
     </ul>
     </div>
     </div>
     </div>
</div>
{{/if}}

       <div class="control-group">
        <label class='control-label'>Description:</label>       
        <div class="controls">
         <textarea class="input-xlarge" id="overview_description" name="overview_description" rows="3"
                                 style="margin-left: 0px; margin-right: 0px; width: 501px; ">{{description}}</textarea>
           
        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Tags:</label>
         <div class="controls">
                        <input type="text" placeholder="Add tags" class="input-xlarge validInput validRegistryName" id="overview_tags" name="overview_tags" value="{{tags}}" data-role="tagsinput"
                        />
                        <a class="icon-question-sign help_popup" help_data="tag_help"></a>
                        <p id="tag_help" class="hide">{{t "Use keywords and common search terms as tags to group APIs that have similar characteristics. After publishing the API, consumers can click these tags to jump to a group of similar APIs."}}</p>
                    </div>       
    </div>
    <div id="api_designer">
        <div id ="resource_details">
<legend>Resources</legend>
    <div class="resource_create">
        <div class="control-group">
            <label class="control-label" for="inputPassword">URL Pattern</label>
            <div class="controls">
                <div class="input-prepend">
                    <span class="add-on">/{context}/{version}/</span>
                    <input style="width:500px" id="resource_url_pattern" type="text" placeholder="Url Pattern Ex: path/to/resource" class="resource_url_pattern"/>
                </div>
            </div>
        </div>
         <div class="control-group">
            <label class="control-label" for=""></label>
            <div class="controls">              
                    
                    <input type="checkbox" value="GET" class="http_verb_select">  GET  
                    <input type="checkbox" value="POST" class="http_verb_select">  POST                
                    <input type="checkbox" value="PUT" class="http_verb_select">  PUT
                    <input type="checkbox" value="DELETE" class="http_verb_select">  DELETE
                    <input type="checkbox" value="OPTIONS" class="http_verb_select">  OPTIONS                  
                
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="inputResource">Resource Name</label>
            <div class="controls">
                <input type="text" id="inputResource" placeholder="Resource">
            </div>
        </div>
        <button class="btn" type="button" id="add_resource" style="margin:0 0 10px 10px;"><i class="icon-plus-sign"></i>&nbsp;{{t "Add New Resource"}}</button>
    </div> 
</div>
    </div>      
   <input type="hidden" name="action" value="design" />
                <input type="hidden" id="swagger" name="swagger" />
                <div class="form-actions" style="display:none" id="saveMessage">
                    <div class="btn loadingButton">Saving API. Please wait..</div>
                </div>
    <div class="form-actions" id="saveButtons">
                    <input type="submit" class="btn btn-primary" value="Save" action="design"/>
                    <a class="btn btn-primary" id="go_to_implement">Implement</a>                     
                    <input type="reset"  class="btn" value="{{t "cancel"}}" onclick="javascript:window.location.href='./'" />                    
                </div>
</form>
<script id="designer-apidoc-template" type="text/x-handlebars-template">

</script>







<hr/>
